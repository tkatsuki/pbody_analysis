{
    "collab_server" : "",
    "contents" : "library(dipr)\nlibrary(EBImage)\nlibrary(ggplot2)\ndir <- \"G:/Yuzuru/Colocalization/171003 P0 DDx6 Dcp1a CDH1/WT 100x Zm1 -2.oif.files\"\n\npbodynum <- function(dir, mol, molthresh=0.1, pbodythresh=0.05, cadch, pbodych, molch){\n  filelist <- list.files(dir, pattern=\".tif\")\n\n  npbody <- list()\n  ngerm <- list()\n  npbody_per_germ <- list()\n  pbodysize <- list()\n  intpbody <- list()\n  intgerm <- list()\n  cells <- list()\n  #cadch <- 3\n  #pbodych <- 2\n  #molch <- 1\n  #molthresh=0.1\n  #pbodythresh=0.05\n  \n    cad <- readImage(paste0(dir, \"/\", filelist[4]))\n    pbody <-  readImage(paste0(dir, \"/\", filelist[3]))\n    h <- dim(cad)[1]\n    w <- dim(cad)[2]\n    \n    # Creating germ mask\n    cadblur <- gblur(cad, 5) \n    cmask2 <- thresh(cadblur, 15, 15, 0.001)\n    cmask3 <- bwlabel(cmask2)\n    csize1 <- computeFeatures.shape(cmask3)\n    cid1 <- which(csize1[,'s.area'] < 4000)\n    cmask4 <- rmObjects(cmask3, cid1)\n    cmask4 <- cmask4 > 0\n    cmask5 <- thinning(cmask4)\n    cmask6 <- fillHull(cmask5)\n    cmask7 <- cmask6 - cmask5\n    cmask8 <- bwlabel(cmask7)\n    csize2 <- computeFeatures.shape(cmask8)\n    cid2 <- which(csize2[,'s.area'] < 4000)\n    cmask9 <- rmObjects(cmask8, cid2)\n    cmask9er <- erode(cmask9, makeBrush(3, shape=\"diamond\"))\n    germftr <- computeFeatures.shape(cmask9er)\n    rid <- which(germftr[, 's.radius.sd'] > 11)\n    cmask10 <- rmObjects(cmask9, rid)\n    ngerm <- max(cmask10)\n    cmask11 <- cmask10 > 0\n    cmask12 <- Image(array(c(cmask10, 0*cmask10, cmask10), dim=c(h, w, 3)))\n    colorMode(cmask12) <- \"Color\"\n    cadc <- Image(array(c(cad, cad, cad), dim=c(h, w, 3)))\n    colorMode(cadc) <- \"Color\"\n    \n    # Creating p-body mask\n    pbodyint <- computeFeatures.basic(cmask11, pbody)[1]\n    pbodybl <- gblur(pbody, 3, 5)\n    pbodybg <- gblur(pbody, 5, 9)\n    pbodydn <- pbodybl - pbodybg\n    pbodythresh <- 0.5*pbodyint\n    pmask <- thresh(pbodydn, 100, 100, pbodythresh)\n    pmask3 <- bwlabel(pmask)\n    psize <- computeFeatures.shape(pmask3)\n    pid <- which(psize[,'s.area'] < 4)\n    pmask4 <- rmObjects(pmask3, pid)\n    pmask5 <- pmask4 > 0\n    pmask6 <- Image(array(c(pbody+pmask5, pbody-pmask5, pbody+pmask5), dim=c(h, w, 3)))\n    colorMode(pmask6) <- \"Color\"\n    \n    # \n    cellst <- stackObjects(cmask10, cmask10) > 0\n    edgest <- dilate(cellst, makeBrush(3, \"diamond\")) - cellst\n    pbodyst <- stackObjects(cmask10, pmask5)\n    cellstint <- apply(stackObjects(cmask10, img), 3, mean)\n    mergest <- rgbImage(edgest, edgest+(pbodyst>0),edgest)\n    pbodystnum <-  apply(bwlabel(pbodyst), 3, max)\n    cells <- data.frame(file=rep(paste(dir, \"/result\", sep=\"\")), \n                             pbodystnum, cellstint)\n    \n    # Mask pbody with germ cell mask\n    germpbody <- pmask5 * cmask11\n\n    # Save processed images\n    writeImage(rgbImage(pbody, pbody, pbody), paste(dir,  \"/pbody.png\", sep=\"\"))\n    writeImage(pbodybg, paste(dir, \"/pbodybg.png\", sep=\"\"))\n    writeImage(pbodydn, paste(dir, \"/pbodydn.png\", sep=\"\"))\n    writeImage(pmask, paste(dir, \"/pbodymask.png\", sep=\"\"))\n    writeImage(pmask4, paste(dir,  \"/pbodymaskdn.png\", sep=\"\"))\n    writeImage(pmask6, paste(dir,  \"/pbodyaddmask.tif\", sep=\"\"))\n    writeImage(rgbImage(cad, cad, cad), paste(dir,  \"/cad.png\", sep=\"\"))\n    writeImage(cadblur, paste(dir,  \"/cadblur.png\", sep=\"\"))\n    writeImage(cmask3, paste(dir, \"/cadmask3.png\", sep=\"\"))\n    writeImage(cmask4, paste(dir,  \"/cadmask4.png\", sep=\"\"))\n    writeImage(cmask5, paste(dir,  \"/cadmask5.png\", sep=\"\"))\n    writeImage(normalize(cmask10), paste(dir, \"/cadmask10.png\", sep=\"\"))\n    writeImage(normalize(cad + (cmask9>0)*0.3), paste(dir, \"/cadmask9m.png\", sep=\"\"))\n    writeImage(normalize(cad + (cmask10>0)*0.3), paste(dir,  \"/cadmask9m2.png\", sep=\"\"))\n    writeImage(cadc + (cmask12>0)*0.3, paste(dir,  \"/cadmask12m.png\", sep=\"\"))\n    writeImage(germpbody, paste(dir, \"/\", \"pbodyfinal\", \".png\", sep=\"\"))\n    writeImage(mergest, paste(dir, \"/\",  \"mergest\", \".png\", sep=\"\"))\n    \n    npbody <- max(bwlabel(germpbody))\n    npbody_per_germ <- max(bwlabel(germpbody))/ngerm\n    ifelse(is.null(germpbodyintav), intpbody <- NA, intpbody <- germpbodyintav)\n    ifelse(is.null(germintav), intgerm <- NA, intgerm <- germintav[[1]])\n    \n  }\n  result <- data.frame(filename=filelist, \n                       pbody = unlist(npbody),\n                       mol = unlist(nmol),\n                       nmolpbody = unlist(nmolpbody),\n                       germ=unlist(ngerm), \n                       pbody_per_germ= unlist(npbody_per_germ),\n                       mol_per_germ= unlist(nmol_per_germ),\n                       mol_pbody_per_germ = unlist(nmolpbody_per_germ),\n                       intmolpbody= unlist(intmolpbody),\n                       intpbody = unlist(intpbody),\n                       germintav = unlist(intgerm))\n  \n  return(list(result, cells))\n\nptm <- proc.time()\n# Control vs Tg +/- series\nresult1 <- pbodynum(dir1, mol=\"nanos2\", molthresh=0.05, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result1, file=paste(dir1, \"3-5_048.rds\", sep=\"\"))\nresult2 <- pbodynum(dir2, mol=\"nanos2\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result2, file=paste(dir2, \"3-5_048.rds\", sep=\"\"))\nresult3 <- pbodynum(dir3, mol=\"nanos2\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result3, file=paste(dir3, \"3-5_048.rds\", sep=\"\"))\nresult4 <- pbodynum(dir4, mol=\"nanos2\", molthresh=0.05, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result4, file=paste(dir4, \"3-5.rds\", sep=\"\"))\nresult5 <- pbodynum(dir5, mol=\"nanos2\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result5, file=paste(dir5, \"3-5_048.rds\", sep=\"\"))\nresult6 <- pbodynum(dir6, mol=\"nanos2\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result6, file=paste(dir6, \"3-5_048.rds\", sep=\"\"))\nresult14 <- pbodynum(dir14, mol=\"nanos2\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result14, file=paste(dir14, \"3-5_048.rds\", sep=\"\"))\nproc.time() - ptm\nresult1 <- readRDS(file=paste(dir1, \"3-4.rds\", sep=\"\"))\nresult2 <- readRDS(file=paste(dir2, \"3-4.rds\", sep=\"\"))\nresult3 <- readRDS(file=paste(dir3, \"3-4.rds\", sep=\"\"))\nresult4 <- readRDS(file=paste(dir4, \"3-4.rds\", sep=\"\"))\nresult5 <- readRDS(file=paste(dir5, \"3-4.rds\", sep=\"\"))\nresult6 <- readRDS(file=paste(dir6, \"3-4.rds\", sep=\"\"))\nresult14 <- readRDS(file=paste(dir14, \"3-4.rds\", sep=\"\"))\n\n# Image-wise analysis\ndfcont <- rbind(result1[[1]][1:12,], result2[[1]][1:15,], result3[[1]][1:11,], result5[[1]][1:15,], result6[[1]][1:15,], result14[[1]][1:15,])\ndfnoutr <- rbind(result1[[1]][13:24,], result2[[1]][16:40,], result3[[1]][12:21,], result5[[1]][16:30,], result6[[1]][16:28,], result14[[1]][16:30,])\ndfutr <- rbind(result1[[1]][25:36,], result2[[1]][41:55,], result3[[1]][22:31,], result5[[1]][31:46,], result14[[1]][31:45,])\ndfall <- rbind(dfcont, dfnoutr, dfutr)\n\n# Cell-wise analysis\ndfcellcont <- rbind(do.call(rbind.data.frame, result1[[2]][1:12]), do.call(rbind.data.frame, result2[[2]][1:15]), do.call(rbind.data.frame, result3[[2]][1:11]), do.call(rbind.data.frame, result5[[2]][1:15]), do.call(rbind.data.frame, result6[[2]][1:15]), do.call(rbind.data.frame, result14[[2]][1:15]))\ndfcellnoutr <- rbind(do.call(rbind.data.frame, result1[[2]][13:24]), do.call(rbind.data.frame, result2[[2]][16:40]), do.call(rbind.data.frame, result3[[2]][12:21]), do.call(rbind.data.frame, result5[[2]][16:30]), do.call(rbind.data.frame, result6[[2]][16:28]), do.call(rbind.data.frame, result14[[2]][16:30]))\ndfcellutr <- rbind(do.call(rbind.data.frame, result1[[2]][25:36]), do.call(rbind.data.frame, result2[[2]][41:55]), do.call(rbind.data.frame, result3[[2]][22:31]), do.call(rbind.data.frame, result5[[2]][31:46]), do.call(rbind.data.frame, result14[[2]][31:45]))\ndfcellall <- rbind(dfcellcont, dfcellnoutr, dfcellutr)\n\ndfcellcont[,1] <- rep(\"Control\")\ndfcellnoutr[,1] <- rep(\"Dazl3F;Flp\")\ndfcellutr[,1] <- rep(\"Dazl3F\")\ndfcellcont <- cbind(dfcellcont, molperpbody=dfcellcont$pbodymolstnum/dfcellcont$pbodystnum)\ndfcellnoutr <- cbind(dfcellnoutr, molperpbody=dfcellnoutr$pbodymolstnum/dfcellnoutr$pbodystnum)\ndfcellutr <- cbind(dfcellutr, molperpbody=dfcellutr$pbodymolstnum/dfcellutr$pbodystnum)\ndfcellall <- rbind(dfcellcont, dfcellnoutr, dfcellutr)\n\n# Extract outliers for pbody\npbodycontout <- dfcellcont[which(dfcellcont[,\"pbodystnum\"]>7),]\npbodynoutrout <- dfcellnoutr[which(dfcellnoutr[,\"pbodystnum\"]>6),]\npbodyutrout <- dfcellutr[which(dfcellutr[,\"pbodystnum\"]>7),]\npbodyallout <- rbind(pbodycontout, pbodynoutrout, pbodyutrout)\n\nwindowsFonts(calibri = windowsFont(\"Calibri\"))\nn_fun <- function(x){\n  return(data.frame(y = 0, label = paste0(\"(\", length(x), \")\")))\n}\n\nm <- ggplot() +\n  geom_boxplot(data = dfcellall, aes(factor(file), y=pbodystnum), outlier.colour=NA) +\n  geom_dotplot(data = pbodyallout, aes(factor(file), y=pbodystnum),  binaxis = \"y\", \n               stackdir = \"center\", position = position_jitter(width=0, height = 0.3), \n               binwidth = 1, dotsize=0.1, stackratio=0.2) +\n  scale_y_continuous(breaks=seq(0, 12, by=2), name=\"Number of granules/cell\") +\n  xlab(\"\") +\n  theme_bw() +\n  theme(axis.text.x=element_text(angle = 90, vjust=0.3, hjust = 1, size=18, color=1), \n        axis.title.x=element_text(size=18),\n        strip.text.x = element_text(size = 18),\n        axis.title.y=element_text(vjust=0.6, size=18),\n        axis.text.y=element_text(size=18, color=1))+\n  theme(panel.border = element_rect(fill=NA, colour = \"black\", size=1)) \nm\nggsave(filename=\"pbodynumber0219.png\", plot=m, width=2, height=7)\n\n# Extract outliers for Nanos2nanos2contout <- dfcellcont[which(dfcellcont[,\"molstnum\"]>7),]\nnanos2noutrout <- dfcellnoutr[which(dfcellnoutr[,\"molstnum\"]>5),]\nnanos2utrout <- dfcellutr[which(dfcellutr[,\"molstnum\"]>7),]\nnanos2allout <- rbind(nanos2contout, nanos2noutrout, nanos2utrout)\n\nm <- ggplot() +\n  geom_boxplot(data = dfcellall, aes(factor(file), y=molstnum), outlier.colour=NA) +\n  geom_dotplot(data = nanos2allout, aes(factor(file), y=molstnum),  binaxis = \"y\", \n               stackdir = \"center\", position = position_jitter(width=0, height = 0.2), \n               binwidth = 1, dotsize=0.1, stackratio=0.4) +\n  scale_y_continuous(breaks=seq(0, 18, by=2), name=\"Number of granules/cell\") +\n  xlab(\"\") +\n  theme_bw() +\n  theme(axis.text.x=element_text(angle = 90, vjust=0.3, hjust = 1, size=18, color=1), \n        axis.title.x=element_text(size=18),\n        strip.text.x = element_text(size = 18),\n        axis.title.y=element_text(vjust=0.6, size=18),\n        axis.text.y=element_text(size=18, color=1))+\n  theme(panel.border = element_rect(fill=NA, colour = \"black\", size=1))\nm\nggsave(filename=\"nanos2number0219.png\", plot=m, width=2, height=7)\n\n# Statistical tests\ninstall.packages(\"RcmdrPlugin.EZR\")\nlibrary(RcmdrPlugin.EZR)\n# Image-wise comparison\ngroup <- rep(1:3, c(nrow(dfcont), nrow(dfnoutr), nrow(dfutr)))\napply(dfall[,-1], 2, function(x) Steel.Dwass(x, group)[,\"p\"])\n# Cell-wise comparison\ngroup2 <- rep(1:3, c(nrow(dfcellcont), nrow(dfcellnoutr), nrow(dfcellutr)))\napply(dfcellall[,-1], 2, function(x) Steel.Dwass(x, group2)[,\"p\"])\n\n# How many cells were analyzed?\nnrow(dfcellcont)\nnrow(dfcellutr)\nnrow(dfcellnoutr)\n\n# What were the mean values?\nlibrary(Hmisc)\nround(apply(dfcellcont[,-1], 2, smean.sd), 2)\nround(apply(dfcellutr[,-1], 2, smean.sd), 2)\nround(apply(dfcellnoutr[,-1], 2, smean.sd), 2)\n\n\n# Nanos2 vs Dazl series\nresult7 <- pbodynum(dir7, mol=\"Dazl\", molthresh=0.08, pbodythresh=0.05, cadch=1, pbodych=3, molch=2)\nsaveRDS(result7, file=paste(dir7, \"3-4.rds\", sep=\"\"))\nresult7 <- readRDS(file=paste(dir7, \"3-4.rds\", sep=\"\"))\nresult8 <- pbodynum(dir8, mol=\"Dazl\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result8, file=paste(dir8, \"3-4.rds\", sep=\"\"))\nresult8 <- readRDS(file=paste(dir8, \"3-4.rds\", sep=\"\"))\nresult9 <- pbodynum(dir9, mol=\"nanos2\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result9, file=paste(dir9, \"3-4.rds\", sep=\"\"))\nresult9 <- readRDS(file=paste(dir9, \"3-4.rds\", sep=\"\"))\nresult10 <- pbodynum(dir10, mol=\"Dazl\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result10, file=paste(dir10, \"3-4.rds\", sep=\"\"))\nresult10 <- readRDS(file=paste(dir10, \"3-4.rds\", sep=\"\"))\nresult11 <- pbodynum(dir11, mol=\"nanos2\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result11, file=paste(dir11, \"3-4.rds\", sep=\"\"))\nresult11 <- readRDS(file=paste(dir11, \"3-4.rds\", sep=\"\"))\nresult12 <- pbodynum(dir12, mol=\"Dazl\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result12, file=paste(dir12, \"3-4.rds\", sep=\"\"))\nresult12 <- readRDS(file=paste(dir12, \"3-4.rds\", sep=\"\"))\nresult13 <- pbodynum(dir13, mol=\"nanos2\", molthresh=0.08, pbodythresh=0.05, cadch=3, pbodych=2, molch=1)\nsaveRDS(result13, file=paste(dir13, \"3-4.rds\", sep=\"\"))\nresult13 <- readRDS(file=paste(dir13, \"3-4.rds\", sep=\"\"))\n\nresult7 <- readRDS(file=paste(dir7, \"3-4.rds\", sep=\"\"))\nresult8 <- readRDS(file=paste(dir8, \"3-4.rds\", sep=\"\"))\nresult9 <- readRDS(file=paste(dir9, \"3-4.rds\", sep=\"\"))\nresult10 <- readRDS(file=paste(dir10, \"3-4.rds\", sep=\"\"))\nresult11 <- readRDS(file=paste(dir11, \"3-4.rds\", sep=\"\"))\nresult12 <- readRDS(file=paste(dir12, \"3-4.rds\", sep=\"\"))\nresult13 <- readRDS(file=paste(dir13, \"3-4.rds\", sep=\"\"))\n\ndfcellnanos2all <- rbind(do.call(rbind.data.frame, result9[[2]][1:45]), do.call(rbind.data.frame, result11[[2]][1:15]), do.call(rbind.data.frame, result13[[2]][1:30]))\ndfcelldazlall <- rbind(do.call(rbind.data.frame, result8[[2]][1:44]), do.call(rbind.data.frame, result10[[2]][1:45]), do.call(rbind.data.frame, result12[[2]][1:29]))\ndfcellnanos2all <- cbind(dfcellnanos2all, molperpbody=dfcellnanos2all$pbodymolstnum/dfcellnanos2all$pbodystnum)\ndfcelldazlall <- cbind(dfcelldazlall, molperpbody=dfcelldazlall$pbodymolstnum/dfcelldazlall$pbodystnum)\n\nwilcox.test(dfcellnanos2all[,2], dfcelldazlall[,2])\nwilcox.test(dfcellnanos2all[,3], dfcelldazlall[,3])\nwilcox.test(dfcellnanos2all[,4], dfcelldazlall[,4])\nwilcox.test(dfcellnanos2all[,5], dfcelldazlall[,5])\n\n# How many cells were analyzed?\nnrow(dfcellnanos2all)\nnrow(dfcelldazlall)\n\nlibrary(Hmisc)\n#pbodystnum\nsmean.sd(dfcellnanos2all[,2])\nsmean.sd(dfcelldazlall[,2])\n#molstnum\nsmean.sd(dfcellnanos2all[,3])\nsmean.sd(dfcelldazlall[,3])\n#pbodymolstnum\nsmean.sd(dfcellnanos2all[,4])\nsmean.sd(dfcelldazlall[,4])\n#molperpbody\nsmean.sd(dfcellnanos2all[,5])\nsmean.sd(dfcelldazlall[,5])\n\nggplot(dfcellall, aes(x=pbodystnum, fill=file)) + geom_histogram(binwidth=.5, alpha=.8, position=\"dodge\")\nggplot(dfcellall, aes(x=molstnum, fill=file)) + geom_histogram(binwidth=.5, alpha=.8, position=\"dodge\")\nggplot(dfcellall, aes(x=pbodymolstnum, fill=file)) + geom_histogram(binwidth=.5, alpha=.8, position=\"dodge\")\n\n# Extract certain images\nextractimg <- function(dir, imgtype){\n  filelist <- list.files(dir, pattern=\".lsm\")\n  filename <- unlist(lapply(filelist, function(x) strsplit(x, \".lsm\")[[1]]))\n  for(i in 1:length(filename))\n  {\n    imgname <- paste(dir, \"/\", filename[i], \"/\", imgtype, sep=\"\")\n    tmp <- readImage(imgname)\n    writeImage(tmp, paste(dir, \"/\", filename[i], imgtype, sep=\"\"))\n  }\n}\n\nextractimg(dir1, \"nanos2addmask.png\")\nextractimg(dir1, \"pbodyaddmask.png\")\nextractimg(dir2, \"nanos2addmask.png\")\nextractimg(dir2, \"pbodyaddmask.png\")\nextractimg(dir3, \"nanos2addmask.png\")\nextractimg(dir3, \"pbodyaddmask.png\")\nextractimg(dir4, \"nanos2addmask.png\")\nextractimg(dir4, \"pbodyaddmask.png\")\nextractimg(dir5, \"nanos2addmask.png\")\nextractimg(dir5, \"pbodyaddmask.png\")\nextractimg(dir6, \"nanos2addmask.png\")\nextractimg(dir6, \"pbodyaddmask.png\")\n\n\n# Nanos2-pbody from Cont\nround(apply(dfcont[,-1], 2, mean, na.rm=TRUE), 2)\nround(apply(dfcont[,-1], 2, sd, na.rm=TRUE), 2)\n\n# Nanos2-pbody from UTR-\nround(apply(dfnoutr[,-1], 2, mean, na.rm=TRUE), 2)\nround(apply(dfnoutr[,-1], 2, sd, na.rm=TRUE), 2)\n\n# Nanos2-pbody from UTR+\nround(apply(dfutr[,-1], 2, mean, na.rm=TRUE), 2)\nround(apply(dfutr[,-1], 2, sd, na.rm=TRUE), 2)\n\npbodystat <- function(df, g1s, g1e, g2s, g2e, g3s, g3e){\n  library(DTK)\n  # pbody number per image\n  c <- 2\n  vec <- c(df[g1s:g1e,c], df[g2s:g2e,c], df[g3s:g3e,c])\n  vec <- vec[!is.na(vec)]\n  f1 <- gl.unequal(n=3,k=c(length(df[g1s:g1e,c][!is.na(df[g1s:g1e,c])]),\n                           length(df[g2s:g2e,c][!is.na(df[g2s:g2e,c])]),\n                           length(df[g3s:g3e,c][!is.na(df[g3s:g3e,c])])))\n  TK.result1<-TK.test(x=vec,f=f1,a=0.05)\n  \n  # germ cell number per image\n  c <- 4\n  vec <- c(df[g1s:g1e,c], df[g2s:g2e,c], df[g3s:g3e,c])\n  vec <- vec[!is.na(vec)]\n  f1 <- gl.unequal(n=3,k=c(length(df[g1s:g1e,c][!is.na(df[g1s:g1e,c])]),\n                           length(df[g2s:g2e,c][!is.na(df[g2s:g2e,c])]),\n                           length(df[g3s:g3e,c][!is.na(df[g3s:g3e,c])])))\n  TK.result2<-TK.test(x=vec,f=f1,a=0.05)\n  \n  # number of pbody per germ\n  c <- 6\n  vec <- c(df[g1s:g1e,c], df[g2s:g2e,c], df[g3s:g3e,c])\n  vec <- vec[!is.na(vec)]\n  f1 <- gl.unequal(n=3,k=c(length(df[g1s:g1e,c][!is.na(df[g1s:g1e,c])]),\n                           length(df[g2s:g2e,c][!is.na(df[g2s:g2e,c])]),\n                           length(df[g3s:g3e,c][!is.na(df[g3s:g3e,c])])))\n  TK.result3<-TK.test(x=vec,f=f1,a=0.05)\n  TK.result3\n  \n  # number of Nanos2 that overlap with pbody per germ\n  c <- 8\n  vec <- c(df[g1s:g1e,c], df[g2s:g2e,c], df[g3s:g3e,c])\n  vec <- vec[!is.na(vec)]\n  f1 <- gl.unequal(n=3,k=c(length(df[g1s:g1e,c][!is.na(df[g1s:g1e,c])]),\n                           length(df[g2s:g2e,c][!is.na(df[g2s:g2e,c])]),\n                           length(df[g3s:g3e,c][!is.na(df[g3s:g3e,c])])))\n  TK.result4<-TK.test(x=vec,f=f1,a=0.05)\n  TK.result4\n  \n  # Average intensity of Nanos2 granules that overlap with pbody per germ\n  c <- 9\n  vec <- c(df[g1s:g1e,c], df[g2s:g2e,c], df[g3s:g3e,c])\n  vec <- vec[!is.na(vec)]\n  f1 <- gl.unequal(n=3,k=c(length(df[g1s:g1e,c][!is.na(df[g1s:g1e,c])]),\n                           length(df[g2s:g2e,c][!is.na(df[g2s:g2e,c])]),\n                           length(df[g3s:g3e,c][!is.na(df[g3s:g3e,c])])))\n  TK.result5<-TK.test(x=vec,f=f1,a=0.05)\n  TK.result5 \n  \n  # Average intensity of Nanos2 that overlap with pbody per germ\n  c <- 10\n  vec <- c(df[g1s:g1e,c], df[g2s:g2e,c], df[g3s:g3e,c])\n  vec <- vec[!is.na(vec)]\n  f1 <- gl.unequal(n=3,k=c(length(df[g1s:g1e,c][!is.na(df[g1s:g1e,c])]),\n                           length(df[g2s:g2e,c][!is.na(df[g2s:g2e,c])]),\n                           length(df[g3s:g3e,c][!is.na(df[g3s:g3e,c])])))\n  TK.result6<-TK.test(x=vec,f=f1,a=0.05)\n  TK.result6\n  \n  # Average intensity of Nanos2 per germ\n  c <- 11\n  vec <- c(df[g1s:g1e,c], df[g2s:g2e,c], df[g3s:g3e,c])\n  vec <- vec[!is.na(vec)]\n  f1 <- gl.unequal(n=3,k=c(length(df[g1s:g1e,c][!is.na(df[g1s:g1e,c])]),\n                           length(df[g2s:g2e,c][!is.na(df[g2s:g2e,c])]),\n                           length(df[g3s:g3e,c][!is.na(df[g3s:g3e,c])])))\n  TK.result7<-TK.test(x=vec,f=f1,a=0.05)\n  TK.result7$f[,\"p adj\"]\n  \n  allres <- data.frame(\"number of pbody per image\" = TK.result1$f[,\"p adj\"],\n                       \"number of germ cells per image\" = TK.result2$f[,\"p adj\"],\n                       \"number of pbody per germ\" = TK.result3$f[,\"p adj\"],\n                       \"number of Nanos2 in pbody\" = TK.result4$f[,\"p adj\"],\n                       \"intensity of Nanos2 granules in pbody\" = TK.result5$f[,\"p adj\"],\n                       \"intensity of Nanos2 in pbody\" = TK.result6$f[,\"p adj\"],\n                       \"intensity of Nanos2 per germ\" = TK.result7$f[,\"p adj\"])\n  return(allres)\n}\n\npbodystat(result2[[1]], g1s=1, g1e=12, g2s=13, g2e=24, g3s=25, g3e=36)\npbodystat(dfall, \n          g1s=1, g1e=nrow(dfcont), \n          g2s=nrow(dfcont)+1, g2e=nrow(dfcont)+nrow(dfnoutr), \n          g3s=nrow(dfcont)+nrow(dfnoutr)+1, g3e=nrow(dfcont)+nrow(dfnoutr)+nrow(dfutr))\n\n\ndf1 <- data.frame(cond=factor(rep(\"nanos2hetero\")), size=unlist(nanos2result[[2]][1:10]))\ndf2 <- data.frame(cond=factor(rep(\"nanos2homo\")), size=unlist(nanos2result[[2]][11:20]))\ndf3 <- data.frame(cond=factor(rep(\"dazlhetero\")), size=unlist(dazlresult[[2]][1:10]))\ndf4 <- data.frame(cond=factor(rep(\"dazlhomo\")), size=unlist(dazlresult[[2]][11:20]))\ndf <- rbind(df1, df2, df3, df4)\n\nlibrary(ggplot2)\npng(file=\"pbodysize.png\", width=1000, res=150)\nggplot(df, aes(x=size, fill=cond)) + geom_histogram(binwidth=10, position=\"dodge\") + xlim(0, 100) + scale_fill_manual(values=c(\"#3399FF\", \"#99CCFF\", \"#FF66CC\", \"#FFBBCC\"))\ndev.off()\n",
    "created" : 1509836721524.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1027685239",
    "id" : "6C9CED57",
    "lastKnownWriteTime" : 1511990348,
    "last_content_update" : 1511990348681,
    "path" : "~/GitHub/pbody_analysis/countpbody.R",
    "project_path" : "countpbody.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}