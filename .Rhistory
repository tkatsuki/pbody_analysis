library(dipr)
library(ggplot2)
dir1 <- "G:/Yuzuru/Colocalization/171003 P0 DDx6 Dcp1a CDH1/WT 100x Zm1 -2.oif.files"
filelist <- list.files(dir, pattern=".tif")
dir <- "G:/Yuzuru/Colocalization/171003 P0 DDx6 Dcp1a CDH1/WT 100x Zm1 -2.oif.files"
filelist <- list.files(dir, pattern=".tif")
filelist
npbody <- list()
nmol <- list()
nmolpbody <- list()
ngerm <- list()
npbody_per_germ <- list()
nmol_per_germ <- list()
nmolpbody_per_germ <- list()
pbodysize <- list()
intmolpbody <- list()
intpbody <- list()
intgerm <- list()
cells <- list()
#i <- 2
library(EBImage)
cad <- readImage(paste0(dir, filename[3]))
cad <- readImage(paste0(dir, filelist[3]))
cad <- readImage(paste0(dir, "/", filelist[3]))
display(cad)
cad <- readImage(paste0(dir, "/", filelist[4]))
img <-  readImage(paste0(dir, "/", filelist[2]))
pbody <-  readImage(paste0(dir, "/", filelist[3]))
cadblur <- gblur(cad, 5)
cmask2 <- thresh(cadblur, 40, 40, 0.005)
cmask3 <- bwlabel(cmask2)
csize1 <- computeFeatures.shape(cmask3)
cid1 <- which(csize1[,'s.area'] < 4000)
cmask4 <- rmObjects(cmask3, cid1)
cmask4 <- cmask4 > 0
cmask5 <- thinning(cmask4)
cmask6 <- fillHull(cmask5)
cmask7 <- cmask6 - cmask5
cmask8 <- bwlabel(cmask7)
csize2 <- computeFeatures.shape(cmask8)
cid2 <- which(csize2[,'s.area'] < 4000)
cmask9 <- rmObjects(cmask8, cid2)
cmask9er <- erode(cmask9, makeBrush(3, shape="diamond"))
germftr <- computeFeatures.shape(cmask9er)
rid <- which(germftr[, 's.radius.sd'] > 11)
cmask10 <- rmObjects(cmask9, rid)
ngerm[[i]] <- max(cmask10)
cmask11 <- cmask10 > 0
cmask12 <- Image(array(c(cmask10, 0*cmask10, cmask10), dim=c(h, w, 3)))
colorMode(cmask12) <- "Color"
cadc <- Image(array(c(cad, cad, cad), dim=c(h, w, 3)))
colorMode(cadc) <- "Color"
